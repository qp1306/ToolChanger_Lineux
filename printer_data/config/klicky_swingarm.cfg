#####################################################################
# Swingarm manual stepper (smooth low-speed profile by default)
#####################################################################

[manual_stepper swingarm]
step_pin: PE2
dir_pin: PC5                 # if it still growls, try !PC5
enable_pin: !PF11
microsteps: 8                # fewer microsteps = more per-step torque
rotation_distance: 360       # MOVE units = degrees (MOVE=90 => 90°)
velocity: 8                  # deg/s; start above the worst resonance
accel: 120                   # gentle but not too low
step_pulse_duration: 0.000004  # 4 µs reliable pulse

[tmc2209 manual_stepper swingarm]
uart_pin: PC4
uart_address: 0
run_current: 0.80            # adjust to your motor rating (see note)
hold_current: 0.60
sense_resistor: 0.110
interpolate: true            # smoother microstep interpolation

# Default to SILENT profile (stealthChop) for smooth starts
stealthchop_threshold: 999999    # always on
driver_PWM_AUTOSCALE: true
driver_PWM_AUTOGRAD: true
driver_PWM_GRAD: 14
driver_PWM_OFS: 36
driver_PWM_FREQ: 1               # typical smooth setting
# (The above PWM values are safe starting points; we can tweak if needed)


[gcode_macro SWINGARM_ZERO]
description: "Set current position = 0° (closed)"
gcode:
  MANUAL_STEPPER STEPPER=swingarm SET_POSITION=0
  RESPOND PREFIX="SWINGARM" MSG="Zeroed at 0°"

[gcode_macro SWINGARM_OPEN]
description: "Move to 90° open"
gcode:
  MANUAL_STEPPER STEPPER=swingarm ENABLE=1
  MANUAL_STEPPER STEPPER=swingarm MOVE=90 SPEED=8

[gcode_macro SWINGARM_CLOSE]
description: "Move to 0° closed"
gcode:
  MANUAL_STEPPER STEPPER=swingarm ENABLE=1
  MANUAL_STEPPER STEPPER=swingarm MOVE=0 SPEED=8
